<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Busqueda PageRank</title>
</head>
<body>
<h1>Busqueda impulsada por PageRank</h1>

<div th:if="${message != null}">
    <p th:text="${message}">Mensaje</p>
</div>

<section>
    <p>Ventana de recoleccion: <span th:text="${settings.collectionWindow()}">PT15M</span></p>
    <p>Damping: <span th:text="${settings.damping()}">0.85</span>, Epsilon: <span th:text="${settings.epsilon()}">1e-6</span></p>
    <p th:if="${metrics != null}">
        Ultima corrida PageRank:
        modo <span th:text="${metrics.mode()}">batch</span>,
        iteraciones <span th:text="${metrics.iterations()}">0</span>,
        delta promedio <span th:text="${#numbers.formatDecimal(metrics.averageDelta(),1,6)}">0</span>,
        nodos <span th:text="${metrics.nodeCount()}">0</span>,
        convergio? <span th:text="${metrics.converged()}">false</span>,
        limitado por tiempo? <span th:text="${metrics.timeLimited()}">false</span>,
        duracion <span th:text="${metrics.elapsed()}">PT0S</span>.
    </p>
    <div th:if="${metrics == null}">
        <p>Aun no se ejecuta PageRank.</p>
        <form th:action="@{/search/run-pagerank}" method="post">
            <input type="hidden" name="q" th:value="${query}">
            <input type="hidden" name="k" th:value="${limit}">
            <button type="submit">Ejecutar PageRank</button>
        </form>
    </div>
</section>

<br>

<form th:action="@{/search}" method="get">
    <label>Consulta:</label>
    <input type="text" name="q" th:value="${query}">
    <label>Top K:</label>
    <input type="number" name="k" min="1" th:value="${limit}">
    <button type="submit">Buscar</button>
</form>

<section>
    <p th:if="${#lists.isEmpty(results)}">No hay resultados para mostrar.</p>

    <div th:each="result : ${results}">
        <h3>
            <span th:text="${result.name()}">Nombre</span>
            (<span th:text="${#numbers.formatDecimal(result.score(), 1, 4)}">0.0</span>)
        </h3>
        <p th:text="${result.explanation()}">Explicacion breve.</p>
        <p>
            <strong>Ultima actualizacion:</strong>
            <span th:text="${result.updatedAt() != null ? #temporals.format(result.updatedAt(),'yyyy-MM-dd HH:mm') : 'N/D'}">N/D</span>
        </p>
        <div>
            <strong>Top aportantes:</strong>
            <ul>
                <li th:if="${#lists.isEmpty(result.contributors())}">No hay aportantes</li>
                <li th:each="c : ${result.contributors()}"
                    th:text="|${c.name()} (${#numbers.formatDecimal(c.contribution(),1,4)})|">Aportante</li>
            </ul>
        </div>
        <div th:if="${result.id() != null}">
            <form th:action="@{/follows/{id}(id=${result.id()})}" method="get">
                <button type="submit">Editar seguidos</button>
            </form>
        </div>
        <hr>
    </div>
</section>
</body>
</html>
